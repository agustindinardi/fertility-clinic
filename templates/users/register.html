{% extends 'base.html' %}

{% block title %}Registro de Paciente - Clínica de Fertilidad{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <div class="auth-header">
            <h1 class="auth-title">Registro de Paciente</h1>
            <p class="auth-subtitle">Complete el formulario para crear su cuenta</p>
        </div>

        <form method="post" data-validate>
            {% csrf_token %}
            
            <!-- Sección de datos personales -->
            <div style="margin-bottom: 1.5rem;">
                <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-primary);">
                    Datos Personales
                </h3>
                
                <div class="grid grid-cols-2" style="gap: 1rem;">
                    <div class="form-group">
                        <label for="first_name" class="form-label">Nombre *</label>
                        <input 
                            type="text" 
                            id="first_name" 
                            name="first_name" 
                            class="form-control" 
                            placeholder="{{ form.first_name.field.widget.attrs.placeholder }}"
                            required
                            value="{{ form.first_name.value|default:'' }}"
                        >
                    </div>

                    <div class="form-group">
                        <label for="last_name" class="form-label">Apellido *</label>
                        <input 
                            type="text" 
                            id="last_name" 
                            name="last_name" 
                            class="form-control" 
                            placeholder="{{ form.last_name.field.widget.attrs.placeholder }}"
                            required
                            value="{{ form.last_name.value|default:'' }}"
                        >
                    </div>
                </div>

                <div class="grid grid-cols-2" style="gap: 1rem;">
                    <div class="form-group">
                        <label for="dni" class="form-label">DNI *</label>
                        <input 
                            type="text" 
                            id="dni" 
                            name="dni" 
                            class="form-control" 
                            placeholder="{{ form.dni.field.widget.attrs.placeholder }}"
                            required
                            value="{{ form.dni.value|default:'' }}"
                        >
                    </div>

                    <div class="form-group">
                        <label for="date_of_birth" class="form-label">Fecha de Nacimiento *</label>
                        <input 
                            type="date" 
                            id="date_of_birth" 
                            name="date_of_birth" 
                            class="form-control" 
                            required
                            value="{{ form.date_of_birth.value|default:'' }}"
                        >
                    </div>
                </div>

                <div class="grid grid-cols-2" style="gap: 1rem;">
                    <div class="form-group">
                        <label for="biological_sex" class="form-label">Sexo Biológico *</label>
                        <select id="biological_sex" name="biological_sex" class="form-control" required>
                            <option value="">Seleccione...</option>
                            <option value="M" {% if form.biological_sex.value == 'M' %}selected{% endif %}>Masculino</option>
                            <option value="F" {% if form.biological_sex.value == 'F' %}selected{% endif %}>Femenino</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="phone" class="form-label">Teléfono</label>
                        <input 
                            type="tel" 
                            id="phone" 
                            name="phone" 
                            class="form-control" 
                            placeholder="{{ form.phone.field.widget.attrs.placeholder }}"
                            value="{{ form.phone.value|default:'' }}"
                        >
                    </div>
                </div>
            </div>

            <!-- Sección de datos de cuenta -->
            <div style="margin-bottom: 1.5rem;">
                <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-primary);">
                    Datos de Cuenta
                </h3>

                <div class="form-group">
                    <label for="username" class="form-label">Usuario *</label>
                    <input 
                        type="text" 
                        id="username" 
                        name="username" 
                        class="form-control" 
                        placeholder="{{ form.username.field.widget.attrs.placeholder }}"
                        required
                        value="{{ form.username.value|default:'' }}"
                    >
                    <small class="form-text">Solo letras, números y @/./+/-/_</small>
                </div>

                <div class="form-group">
                    <label for="email" class="form-label">Email *</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        class="form-control" 
                        placeholder="{{ form.email.field.widget.attrs.placeholder }}"
                        required
                        value="{{ form.email.value|default:'' }}"
                    >
                </div>

                <div class="grid grid-cols-2" style="gap: 1rem;">
                    <div class="form-group">
                        <label for="password1" class="form-label">Contraseña *</label>
                        <input 
                            type="password" 
                            id="password1" 
                            name="password1" 
                            class="form-control" 
                            placeholder="{{ form.password1.field.widget.attrs.placeholder }}"
                            required
                            minlength="8"
                        >
                    </div>

                    <div class="form-group">
                        <label for="password2" class="form-label">Confirmar Contraseña *</label>
                        <input 
                            type="password" 
                            id="password2" 
                            name="password2" 
                            class="form-control" 
                            placeholder="{{ form.password2.field.widget.attrs.placeholder }}"
                            required
                            minlength="8"
                        >
                    </div>
                </div>
            </div>

            <!-- Sección de información médica (opcional) -->
            <div style="margin-bottom: 1.5rem;">
                <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-primary);">
                    Información Médica
                </h3>

                <div class="form-group">
                    <label for="occupation" class="form-label">Ocupación</label>
                    <input 
                        type="text" 
                        id="occupation" 
                        name="occupation" 
                        class="form-control" 
                        placeholder="{{ form.occupation.field.widget.attrs.placeholder }}"
                        value="{{ form.occupation.value|default:'' }}"
                    >
                </div>

                <div class="grid grid-cols-2" style="gap: 1rem;">
                    <div class="form-group">
                        <label for="medical_coverage" class="form-label">Cobertura Médica*</label>
                        <select id="medical_coverage" name="medical_coverage" class="form-control" required>
                            <option value="">Seleccione...</option>
                            {% for choice in form.medical_coverage.field.choices %}
                                <option value="{{ choice.0 }}" {% if form.medical_coverage.value == choice.0 %}selected{% endif %}>
                                    {{ choice.1 }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="member_number" class="form-label">Número de Socio*</label>
                        <input 
                            type="text" 
                            id="member_number" 
                            name="member_number" 
                            class="form-control" 
                            placeholder="{{ form.member_number.field.widget.attrs.placeholder }}"
                            required
                            value="{{ form.member_number.value|default:'' }}"
                        >
                    </div>
                </div>
            </div>

            {% if form.errors %}
                <div class="alert alert-error">
                    {% for field, errors in form.errors.items %}
                        {% for error in errors %}
                            <div>{{ error }}</div>
                        {% endfor %}
                    {% endfor %}
                </div>
            {% endif %}

            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
                Registrarse
            </button>
        </form>

        <div style="text-align: center; margin-top: 1.5rem;">
            <p class="text-muted" style="font-size: 0.875rem;">
                ¿Ya tiene cuenta? 
                <a href="{% url 'login' %}" style="color: var(--primary); text-decoration: none; font-weight: 600;">
                    Iniciar sesión
                </a>
            </p>
        </div>
    </div>
</div>

<script>
    // Password match validation
    document.getElementById('password2').addEventListener('input', function() {
        const password1 = document.getElementById('password1').value;
        const password2 = this.value;
        
        if (password2 && password1 !== password2) {
            this.setCustomValidity('Las contraseñas no coinciden');
        } else {
            this.setCustomValidity('');
        }
    });
</script>
{% endblock %}
