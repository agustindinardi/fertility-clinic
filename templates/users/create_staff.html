{% extends 'base.html' %}

{% block title %}Crear Usuario Staff - Clínica de Fertilidad{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <div class="auth-header">
            <h1 class="auth-title">Crear Usuario Staff</h1>
            <p class="auth-subtitle">Complete el formulario para crear un nuevo usuario del personal</p>
        </div>

        <form method="post" data-validate>
            {% csrf_token %}
            
            <!-- Sección de datos personales -->
            <div style="margin-bottom: 1.5rem;">
                <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-primary);">
                    Datos Personales
                </h3>
                
                <div class="grid grid-cols-2" style="gap: 1rem;">
                    <div class="form-group">
                        <label for="first_name" class="form-label">Nombre *</label>
                        <input 
                            type="text" 
                            id="first_name" 
                            name="first_name" 
                            class="form-control" 
                            placeholder="Ingrese el nombre"
                            required
                            value="{{ form.first_name.value|default:'' }}"
                        >
                    </div>

                    <div class="form-group">
                        <label for="last_name" class="form-label">Apellido *</label>
                        <input 
                            type="text" 
                            id="last_name" 
                            name="last_name" 
                            class="form-control" 
                            placeholder="Ingrese el apellido"
                            required
                            value="{{ form.last_name.value|default:'' }}"
                        >
                    </div>
                </div>

                <div class="grid grid-cols-2" style="gap: 1rem;">
                    <div class="form-group">
                        <label for="dni" class="form-label">DNI *</label>
                        <input 
                            type="text" 
                            id="dni" 
                            name="dni" 
                            class="form-control" 
                            placeholder="Ingrese el DNI"
                            required
                            value="{{ form.dni.value|default:'' }}"
                        >
                    </div>

                    <div class="form-group">
                        <label for="date_of_birth" class="form-label">Fecha de Nacimiento *</label>
                        <input 
                            type="date" 
                            id="date_of_birth" 
                            name="date_of_birth" 
                            class="form-control" 
                            required
                            value="{{ form.date_of_birth.value|default:'' }}"
                        >
                    </div>
                </div>

                <div class="grid grid-cols-2" style="gap: 1rem;">
                    <div class="form-group">
                        <label for="biological_sex" class="form-label">Sexo Biológico *</label>
                        <select id="biological_sex" name="biological_sex" class="form-control" required>
                            <option value="">Seleccione...</option>
                            <option value="M" {% if form.biological_sex.value == 'M' %}selected{% endif %}>Masculino</option>
                            <option value="F" {% if form.biological_sex.value == 'F' %}selected{% endif %}>Femenino</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="phone" class="form-label">Teléfono</label>
                        <input 
                            type="tel" 
                            id="phone" 
                            name="phone" 
                            class="form-control" 
                            placeholder="Ingrese el teléfono"
                            value="{{ form.phone.value|default:'' }}"
                        >
                    </div>
                </div>
            </div>

            <!-- Sección de datos de cuenta -->
            <div style="margin-bottom: 1.5rem;">
                <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-primary);">
                    Datos de Cuenta
                </h3>

                <div class="form-group">
                    <label for="role" class="form-label">Rol *</label>
                    <select id="role" name="role" class="form-control" required>
                        <option value="">Seleccione un rol...</option>
                        <option value="ADMIN" {% if form.role.value == 'ADMIN' %}selected{% endif %}>Administrador</option>
                        <option value="MEDICAL_DIRECTOR" {% if form.role.value == 'MEDICAL_DIRECTOR' %}selected{% endif %}>Director Médico</option>
                        <option value="DOCTOR" {% if form.role.value == 'DOCTOR' %}selected{% endif %}>Médico</option>
                        <option value="LAB_OPERATOR" {% if form.role.value == 'LAB_OPERATOR' %}selected{% endif %}>Operador de Laboratorio</option>
                    </select>
                    <small class="form-text">Los pacientes se registran por su cuenta</small>
                </div>

                <div class="form-group">
                    <label for="username" class="form-label">Usuario *</label>
                    <input 
                        type="text" 
                        id="username" 
                        name="username" 
                        class="form-control" 
                        placeholder="Ingrese el nombre de usuario"
                        required
                        value="{{ form.username.value|default:'' }}"
                    >
                    <small class="form-text">Solo letras, números y @/./+/-/_</small>
                </div>

                <div class="form-group">
                    <label for="email" class="form-label">Email *</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        class="form-control" 
                        placeholder="Ingrese el email"
                        required
                        value="{{ form.email.value|default:'' }}"
                    >
                </div>

                <div class="grid grid-cols-2" style="gap: 1rem;">
                    <div class="form-group">
                        <label for="password1" class="form-label">Contraseña *</label>
                        <input 
                            type="password" 
                            id="password1" 
                            name="password1" 
                            class="form-control" 
                            placeholder="Ingrese la contraseña"
                            required
                            minlength="8"
                        >
                        <small class="form-text">Mínimo 8 caracteres</small>
                    </div>

                    <div class="form-group">
                        <label for="password2" class="form-label">Confirmar Contraseña *</label>
                        <input 
                            type="password" 
                            id="password2" 
                            name="password2" 
                            class="form-control" 
                            placeholder="Confirme la contraseña"
                            required
                            minlength="8"
                        >
                    </div>
                </div>
            </div>

            {% if form.errors %}
                <div class="alert alert-error">
                    {% for field, errors in form.errors.items %}
                        {% for error in errors %}
                            <div><strong>{{ field }}:</strong> {{ error }}</div>
                        {% endfor %}
                    {% endfor %}
                </div>
            {% endif %}

            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button type="submit" class="btn btn-primary" style="flex: 1;">
                    Crear Usuario
                </button>
                <a href="{% url 'manage_users' %}" class="btn btn-secondary" style="flex: 1; text-align: center; text-decoration: none; display: flex; align-items: center; justify-content: center;">
                    Cancelar
                </a>
            </div>
        </form>
    </div>
</div>

<script>
    // Password match validation
    document.getElementById('password2').addEventListener('input', function() {
        const password1 = document.getElementById('password1').value;
        const password2 = this.value;
        
        if (password2 && password1 !== password2) {
            this.setCustomValidity('Las contraseñas no coinciden');
        } else {
            this.setCustomValidity('');
        }
    });
</script>
{% endblock %}
